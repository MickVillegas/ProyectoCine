<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservas de Asientos</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="pelicula-contenedor">
        <label>Elige una película:</label>
        <select id="pelicula" onchange="cambiarOpcion()">
            <option value="10">Los vengadores (10€)</option>
            <option value="12">Joker (12€)</option>
            <option value="6">Toy Story (6€)</option>
            <option value="7">El rey león (7€)</option>
        </select>
        <ul class="mostrador">
            <li>
                <div class="asiento"></div>
                <small>Libre</small>
            </li>
            <li>
                <div class="asiento seleccionado"></div>
                <small>Seleccionado</small>
            </li>
            <li>
                <div class="asiento ocupado"></div>
                <small>Ocupado</small>
            </li>
        </ul>
        <div class="contenedor">
            <div class="pantalla"></div>
            <div class="fila">
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
            </div>
            <div class="fila">
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
            </div>
            <div class="fila">
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
            </div>
            <div class="fila">
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento ocupado"></div>
                <div class="asiento ocupado"></div>
                <div class="asiento ocupado"></div>
                <div class="asiento ocupado"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
            </div>
            <div class="fila">
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
            </div>
            <div class="fila">
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
                <div class="asiento"></div>
            </div>
        </div>
    </div>

    <p class="texto">Has seleccionado <span id="numero">0</span> asientos por un precio total de <span id="total">100</span> euros.</p>

    <script src="app.js"></script>
</body>
</html>

<script>


let arr = [];
let peliselecionada = [];
let venga = [];
let jocker = [];
let toy = [];
let rey = [];


sessionStorage.setItem("lastname", "otracosa");
let personName = sessionStorage.getItem("lastname");
console.log(personName)

    let precioTotal = document.getElementById("total")
    let numeroAsientos = document.getElementById("numero");
    let filasAsientos = document.getElementsByClassName("fila");
    let peliculaSEleccionada = document.getElementById("pelicula");

    let asSelec = 0;
    let precio = 0;


function verAsi(){
    let a = document.getElementsByClassName("fila");

    for(let x = 0; x < a.length; x++){
        console.log("Fila " + x)
        let hijo = a[x].firstElementChild
        while ( hijo != null){
            if(hijo.className == "asiento"){
                venga.push(0);
            }
            else if(hijo.className == "asiento ocupado"){
                venga.push(2);
            }
            else{
                venga.push(1);
            }
    	    //console.log("El contenido del hijo es: "  + hijo.className);
    	    hijo = hijo.nextElementSibling;
	    }
    }
    console.log(venga);
}

verAsi()

    function getAsientos(){
        return asSelec
    }

    function sumarAsiento(){
        asSelec = asSelec + 1;
    }

    function restarAsiento(){
        asSelec = asSelec - 1;
    }

    function getPrecio(){
        return precio
    }

    function sumarPrecio(x){
        precio = precio + parseInt(x)
    }

    function restarPrecio(x){
        precio = precio - parseInt(x)
    }

    for(let i = 0; i < filasAsientos.length; i++){
        filasAsientos[i].addEventListener("click", hazCosas)
    }


    function hazCosas(e){
        let nodoClick;
        if(e){
            nodoClick = e.target;
            console.log(nodoClick.attributes)
            console.log(nodoClick.className)

            if(nodoClick.className == "asiento"){
                let selecionado = peliculaSEleccionada.value
                nodoClick.className = "asiento seleccionado";
                sumarAsiento();
                numeroAsientos.textContent = getAsientos();
                sumarPrecio(selecionado);
                precioTotal.textContent = getPrecio() 
            }
            else if(nodoClick.className == "asiento seleccionado"){
                let selecionado = peliculaSEleccionada.value
                nodoClick.className = "asiento";
                restarAsiento()
                numeroAsientos.textContent = getAsientos();
                restarPrecio(selecionado);
                precioTotal.textContent = getPrecio() 
            }

            else if(nodoClick.className = "asiento ocupado"){
                alert("No se puede quitar asientos ocupados")
            }
        }
    }

    function cambiarOpcion(){
        let selecionado = peliculaSEleccionada.options[peliculaSEleccionada.selectedIndex].text;
        switch(selecionado){
            case "Los vengadores (10€)":
            sessionStorage.setItem("vengadores", 2);
            break;
            case "Joker (12€)":
            sessionStorage.setItem("jocker", 2);
            break;
            case "Toy Story (6€)":
            sessionStorage.setItem("toyStory", 2);
            break;
            case "El rey león (7€)":
            sessionStorage.setItem("reyLeon", 2);
            break;
        }
    }


window.onload = (event) => {
    sessionStorage.setItem("vengadores", 1);
    sessionStorage.setItem("jocker", 1);
    sessionStorage.setItem("toyStory", 1);
    sessionStorage.setItem("reyLeon", 1);
};

</script>

<!-- 
    const asientos = document.querySelectorAll(".fila .asiento:not(.ocupado)");
    let asientosSeleccionados = document.querySelectorAll(".fila .asiento.seleccionado"); 
-->
